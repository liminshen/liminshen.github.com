<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" id="iphone-viewport" content="minimum-scale=1.0, maximum-scale=1.0, width=device-width" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<style type="text/css">
		body{
			width: 100%;
			background-image: url(mage-gnome01-large.jpg);
			background-position: inherit;
		}
		ul,li,div{
			margin: 0px;
			padding: 0px;
		}
	</style>
	<link rel="stylesheet" type="text/css" href="UIPickerView.css">
	<script type="text/javascript" src="UIPickerView.js"></script>
</head>
<body>
	<button id="create-picker">create picker</button>
	<button id="open-picker">open picker</button>
	<button id="close-picker">close picker</button>
	<button id="select-picker">select picker</button>
	<button id="render-picker">render picker</button>


	<div class="region-picker-wrapper visibility-control" id="region-picker">
	    <div class="header">
        	<div class="bar bar-header">
          		<button class="button button-clear" id="selectClose">Close</button>
          		<div class="h3 title">你</div>
          		<button class="button button-clear button-positive" id="selectYes">Yes</button>
        	</div>
     	</div>
	    <div class="body">
	        <div class="select-zone top"></div>
	        <div class="select-zone middle"></div>
	        <div class="select-zone bottom"></div>
	        <div class="region-picker" >
	          	<div id="YearPicker"></div>
	        </div>
	        <div class="region-picker">
	          	<div id="MonthPicker"></div>
	        </div>
	        <div class="region-picker">
	          	<div id="DayPicker"></div>
	        </div>
	    </div>
    </div>

    <script type="text/javascript">
    	var pickerCreate = document.getElementById('create-picker');
		var pickerOpen = document.getElementById('open-picker');
		var pickerClose = document.getElementById('close-picker');
		var pickerSelect = document.getElementById('select-picker');
		var pickerRender = document.getElementById('render-picker');
		
		var up,up1,up2,animaed;

		var selectYes = document.getElementById('selectYes');
		var selectClose = document.getElementById('selectClose');

		var NowDate = new Date();
		var N_y = NowDate.getFullYear();
		var N_m = NowDate.getMonth()+1;
		var YearDate = [],MonthDate = [],DayDate = null;
		// 设置年范围
		for (var i = N_y; i < N_y+5; i++) {
			YearDate.push({
				'key': i ,
				'value' : i
			})
		}
		// 设置月范围
		for (var i = 1; i < 13; i++) {
			MonthDate.push({
				'key': i ,
				'value' : i
			})
		}
		
		function creatDayData(i) {
			var a = [];
			i = i + 1 ;
			for (var j = 1; j < i; j++) {
				a.push({
					'key' : j ,
					'value' : j
				});
			}
			return a ;
		}
		function getDayCount(y,m) {
			var d = new Date();
			d.setFullYear(y,m,0);
			var result = d.getDate();
			DayDate  = creatDayData(result);
			return DayDate;
		}
		function creatDay(ny,nd) {
			var DayPicker = document.querySelector('#DayPicker');
			DayPicker.innerHTML = '';
			up = UIPickerView.createPickerView({
				dataSource:getDayCount(ny,nd),
				id:'DayPicker',
				constraintsId:'wower2',
				kUP:{
					kUPCELLHEIGHT:26,
					kUPFRICTION:0.003
				},
				valueChange:function(data){
					R_d = data.value;

				}
			});
		}

		creatDay(N_y,N_m);

		var R_y,R_m,R_d;

		selectYes.addEventListener('click',function(){
			animaed.finish();
			console.log(R_y);
			console.log(R_m);
			console.log(R_d);

			if (!R_y&& up) {
				up.UPSelectRowIndexPath(1).UPThen(function(indexPath,value){
					console.log(value);
				})
			};

		})

		selectClose.addEventListener('click',function(){
			animaed.finish();
		})

		pickerCreate.addEventListener('click',function(){

			up = UIPickerView.createPickerView({
				dataSource:YearDate,
				id:'YearPicker',
				constraintsId:'wower',
				kUP:{
					kUPCELLHEIGHT:26,
					kUPFRICTION:0.003
				},
				valueChange:function(data){
					R_y = data.value;
					N_y = R_y;
					creatDay(N_y,N_m);
				}
			});

			up1 = UIPickerView.createPickerView({
				dataSource:MonthDate,
				id:'MonthPicker',
				constraintsId:'wower1',
				kUP:{
					kUPCELLHEIGHT:26,
					kUPFRICTION:0.003
				},
				valueChange:function(data){
					R_m = data.value;
					N_m = R_m;
					creatDay(N_y,N_m);
				}
			});

			animaed = CAAnimation.createAnimation({id:'region-picker'});
			animaed.start();

		});

		pickerClose.addEventListener('click',function(){
			animaed.finish();
		});

		pickerOpen.addEventListener('click',function(){
			animaed.start();
		});
    </script>
</body>
</html>